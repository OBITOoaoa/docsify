# 图像处理

[TOC]

## 图像处理的卷积

33滤波和 55滤波是指：卷积核的大小为3x3,5x5。

图像卷积的时候边界像素，不能被卷积操作，原因在于边界像素没有完全跟kernel重叠，所以当33滤波时侯有 1 个像素的边缘没有被处理，55滤波的时候有两个像素的边缘没有被处理。

滤波器的大小应该是奇数，这样它才有一个中心，例如 3x3，5x5 或者 7x7。例如 5x5 大小的核的半径就是 2。

步长：卷积核每一步移动的大小。

## 线性滤波

### 方框滤波

```c++
void boxFilter(InputArray src, OutputArray dst, int ddepth, Size  ksize, Point  anchor = Point(-1,-1), bool  normalize = true, int  borderType = BORDER_DEFAULT )
```

- src：输入图像。
- dst：输出图像，与输入图像具有相同的尺寸和通道数。
- ddepth：输出图像的数据类型（深度），根据输入图像的数据类型不同拥有不同的取值范围，当赋值为-1时，表示输出图像与输入图像一致
- ksize：卷积核尺寸。
- anchor：内核的基准点(锚点)，其默认值为(-1,-1)代表内核基准点位于kernel的中心位置。基准点即卷积核中与进行处理的像素点重合的点，其位置必须在卷积核的内部。
- normalize：是否将卷积核进行归一化的标志，**默认参数为 true**，表示进行归一化。
- borderType：用于推断图像外部像素的某种边界模式，默认参数 BORDER_DEFAULT，表示不包含边界值倒序填充。

**方框滤波在进行归一化后效果和相同卷积核大小的均值滤波的效果相同。**当卷积核大小较大时很容易发生**溢出**现象，使得结果图像变成全白。当 normalize = 0 时，表示不进行归一化操作，此时要计算核内所有像素的和代替原始图像核中心像素的大小，需要注意的是这种方式很容易造成溢出现象，例如当图像的像素用 8 位表示时候，如果所求和大于 255 则大于 255 的部分舍去，直接取255（白色），因此若没有进行归一化操作，一般会出现图像很多地方为白色的问题。

### 均值滤波

```c++
void blur(InputArray src, OutputArray dst, Size ksize , Point anchor=Point(-l , - l) , int borderType=BORDER_DEFAULT) 
```

- src：输入图像。
- dst：输出图像
- ksize：卷积核尺寸
- anchor：内核的基准点(锚点)，其默认值为(-1,-1)代表内核基准点位于borderType：像素外推法选择标志，取值范围在表3-5中给出，默认参数为BORDER_DEFAULT，表示不包含边界值倒序填充

均值滤波本身存在着固有的缺陷，即它**不能很好地保护图像细节，在图像去噪的同时也破坏了图像的细节部分，从而使图像变得模糊，滤波器的尺寸越大，滤波后图像变得越模糊。不能很好地去除噪声点。**

### 高斯滤波

```c++
void GaussianBlur(InputArray src, OutputArray dst, Size ksize, sigmaX, sigmaY, borderType)
```

- src：输入图像
- dst：输出图像
- ksize：高斯卷积核的大小
- sigmaX：水平方向的标准差
- sigmaY：垂直方向的标准差，默认值为0，表示与sigmaX相同
- borderType：边界类型

高斯滤波是一种线性平滑滤波，可以**消除高斯噪声**，广泛应用于图像处理的减噪过程。通俗地讲，高斯滤波就是对整幅图像进行加权平均的过程，**每一个像素点的值，都由其本身和邻域内的其他像素值经过加权平均后得到。**高斯滤波的具体操作是一个模板(或称卷积、掩模)扫描图像中的每一个像素，用模板确定的邻域内像素的加权平均灰度值去替代模板中心像素点的值。



高斯滤波在使图像模糊的基础上，保留了图像的一些特质。有效抑制正态分布的噪声。

## 非线性滤波

### 中值滤波

```c++
void medianBlur(InputArray src, OutputArray dst, int ksize)
```

- src：输入图像
- dst：输出图像
- ksize：卷积核尺寸

中值滤波（Median filter）是一种典型的非线性滤波技术，基本思想是用像素点邻域灰度值的中值来代替该像素点的灰度值，从而消除孤立的噪声点。**该方法在去除脉冲噪声、椒盐噪声的同时又能保留图像的边缘细节。**中值滤波由于需要找出领域中的中值因此花费的时间很长。



### 双边滤波

```
void bilateralFilter(InputArray src , OutputArray dst , int d , double sigmaColor, double sigmaSpace, int borderType = BORDER_DEFAULT) 
```

- src：输入图像
- dst：输出图像
- d：表示在过滤过程中每个像素邻域的直径。如果这个值被设为非正数，那么 OpenCV 会从第五个参数 sigmaSpace 来计算出它
- sigmaColor：颜色空间滤波器的 sigma 值。这个参数的值越大，就表明该像素邻域内有越宽广的颜色会被混合到一起，产生较大的半相等颜色区域
- sigmaSpace：坐标空间中滤波器的 sigma 值，坐标空间的标注方差。它的数值越大，意味着越远的像素会相互影响，从而使更大的区域中足够相似的颜色获取相同的颜色。当 d > 0 时，d 指定了邻域大小且与 sigmaSpace 无关。否则，d 正比于 sigmaSpace



## 形态学变换

腐蚀和膨胀是对白色部分(高亮部分)而言的的，不是黑色部分。膨胀是图像中的高亮部分进行膨胀，类 类似"领域扩张"，效果图拥有比原图更大高亮区域；腐蚀是原图中的高亮部分被腐蚀，类似于"领域被蚕食"，效果图拥有比原图更小的高亮区域。